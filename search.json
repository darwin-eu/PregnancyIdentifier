[{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"Apache License","title":"Apache License","text":"Version 2.0, January 2004 <http://www.apache.org/licenses/>","code":""},{"path":[]},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/LICENSE.html","id":"id_1-definitions","dir":"","previous_headings":"Terms and Conditions for use, reproduction, and distribution","what":"1. Definitions","title":"Apache License","text":"“License” shall mean terms conditions use, reproduction, distribution defined Sections 1 9 document. “Licensor” shall mean copyright owner entity authorized copyright owner granting License. “Legal Entity” shall mean union acting entity entities control, controlled , common control entity. purposes definition, “control” means () power, direct indirect, cause direction management entity, whether contract otherwise, (ii) ownership fifty percent (50%) outstanding shares, (iii) beneficial ownership entity. “” (“”) shall mean individual Legal Entity exercising permissions granted License. “Source” form shall mean preferred form making modifications, including limited software source code, documentation source, configuration files. “Object” form shall mean form resulting mechanical transformation translation Source form, including limited compiled object code, generated documentation, conversions media types. “Work” shall mean work authorship, whether Source Object form, made available License, indicated copyright notice included attached work (example provided Appendix ). “Derivative Works” shall mean work, whether Source Object form, based (derived ) Work editorial revisions, annotations, elaborations, modifications represent, whole, original work authorship. purposes License, Derivative Works shall include works remain separable , merely link (bind name) interfaces , Work Derivative Works thereof. “Contribution” shall mean work authorship, including original version Work modifications additions Work Derivative Works thereof, intentionally submitted Licensor inclusion Work copyright owner individual Legal Entity authorized submit behalf copyright owner. purposes definition, “submitted” means form electronic, verbal, written communication sent Licensor representatives, including limited communication electronic mailing lists, source code control systems, issue tracking systems managed , behalf , Licensor purpose discussing improving Work, excluding communication conspicuously marked otherwise designated writing copyright owner “Contribution.” “Contributor” shall mean Licensor individual Legal Entity behalf Contribution received Licensor subsequently incorporated within Work.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/LICENSE.html","id":"id_2-grant-of-copyright-license","dir":"","previous_headings":"Terms and Conditions for use, reproduction, and distribution","what":"2. Grant of Copyright License","title":"Apache License","text":"Subject terms conditions License, Contributor hereby grants perpetual, worldwide, non-exclusive, -charge, royalty-free, irrevocable copyright license reproduce, prepare Derivative Works , publicly display, publicly perform, sublicense, distribute Work Derivative Works Source Object form.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/LICENSE.html","id":"id_3-grant-of-patent-license","dir":"","previous_headings":"Terms and Conditions for use, reproduction, and distribution","what":"3. Grant of Patent License","title":"Apache License","text":"Subject terms conditions License, Contributor hereby grants perpetual, worldwide, non-exclusive, -charge, royalty-free, irrevocable (except stated section) patent license make, made, use, offer sell, sell, import, otherwise transfer Work, license applies patent claims licensable Contributor necessarily infringed Contribution(s) alone combination Contribution(s) Work Contribution(s) submitted. institute patent litigation entity (including cross-claim counterclaim lawsuit) alleging Work Contribution incorporated within Work constitutes direct contributory patent infringement, patent licenses granted License Work shall terminate date litigation filed.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/LICENSE.html","id":"id_4-redistribution","dir":"","previous_headings":"Terms and Conditions for use, reproduction, and distribution","what":"4. Redistribution","title":"Apache License","text":"may reproduce distribute copies Work Derivative Works thereof medium, without modifications, Source Object form, provided meet following conditions: () must give recipients Work Derivative Works copy License; (b) must cause modified files carry prominent notices stating changed files; (c) must retain, Source form Derivative Works distribute, copyright, patent, trademark, attribution notices Source form Work, excluding notices pertain part Derivative Works; (d) Work includes “NOTICE” text file part distribution, Derivative Works distribute must include readable copy attribution notices contained within NOTICE file, excluding notices pertain part Derivative Works, least one following places: within NOTICE text file distributed part Derivative Works; within Source form documentation, provided along Derivative Works; , within display generated Derivative Works, wherever third-party notices normally appear. contents NOTICE file informational purposes modify License. may add attribution notices within Derivative Works distribute, alongside addendum NOTICE text Work, provided additional attribution notices construed modifying License. may add copyright statement modifications may provide additional different license terms conditions use, reproduction, distribution modifications, Derivative Works whole, provided use, reproduction, distribution Work otherwise complies conditions stated License.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/LICENSE.html","id":"id_5-submission-of-contributions","dir":"","previous_headings":"Terms and Conditions for use, reproduction, and distribution","what":"5. Submission of Contributions","title":"Apache License","text":"Unless explicitly state otherwise, Contribution intentionally submitted inclusion Work Licensor shall terms conditions License, without additional terms conditions. Notwithstanding , nothing herein shall supersede modify terms separate license agreement may executed Licensor regarding Contributions.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/LICENSE.html","id":"id_6-trademarks","dir":"","previous_headings":"Terms and Conditions for use, reproduction, and distribution","what":"6. Trademarks","title":"Apache License","text":"License grant permission use trade names, trademarks, service marks, product names Licensor, except required reasonable customary use describing origin Work reproducing content NOTICE file.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/LICENSE.html","id":"id_7-disclaimer-of-warranty","dir":"","previous_headings":"Terms and Conditions for use, reproduction, and distribution","what":"7. Disclaimer of Warranty","title":"Apache License","text":"Unless required applicable law agreed writing, Licensor provides Work (Contributor provides Contributions) “” BASIS, WITHOUT WARRANTIES CONDITIONS KIND, either express implied, including, without limitation, warranties conditions TITLE, NON-INFRINGEMENT, MERCHANTABILITY, FITNESS PARTICULAR PURPOSE. solely responsible determining appropriateness using redistributing Work assume risks associated exercise permissions License.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/LICENSE.html","id":"id_8-limitation-of-liability","dir":"","previous_headings":"Terms and Conditions for use, reproduction, and distribution","what":"8. Limitation of Liability","title":"Apache License","text":"event legal theory, whether tort (including negligence), contract, otherwise, unless required applicable law (deliberate grossly negligent acts) agreed writing, shall Contributor liable damages, including direct, indirect, special, incidental, consequential damages character arising result License use inability use Work (including limited damages loss goodwill, work stoppage, computer failure malfunction, commercial damages losses), even Contributor advised possibility damages.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/LICENSE.html","id":"id_9-accepting-warranty-or-additional-liability","dir":"","previous_headings":"Terms and Conditions for use, reproduction, and distribution","what":"9. Accepting Warranty or Additional Liability","title":"Apache License","text":"redistributing Work Derivative Works thereof, may choose offer, charge fee , acceptance support, warranty, indemnity, liability obligations /rights consistent License. However, accepting obligations, may act behalf sole responsibility, behalf Contributor, agree indemnify, defend, hold Contributor harmless liability incurred , claims asserted , Contributor reason accepting warranty additional liability. END TERMS CONDITIONS","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/LICENSE.html","id":"appendix-how-to-apply-the-apache-license-to-your-work","dir":"","previous_headings":"","what":"APPENDIX: How to apply the Apache License to your work","title":"Apache License","text":"apply Apache License work, attach following boilerplate notice, fields enclosed brackets [] replaced identifying information. (Don’t include brackets!) text enclosed appropriate comment syntax file format. also recommend file class name description purpose included “printed page” copyright notice easier identification within third-party archives.","code":"Copyright [yyyy] [name of copyright owner]  Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License. You may obtain a copy of the License at    http://www.apache.org/licenses/LICENSE-2.0  Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License."},{"path":[]},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/STYLE.html","id":"naming-conventions","dir":"","previous_headings":"","what":"Naming conventions","title":"PregnancyIdentifier code style","text":"Function names (e.g. runEsd, mergeOutcomeAndGestation, getGtTiming) Argument names (e.g. outputDir, startDate, personIds, episodesWithGestationalTimingInfoDf) Variable names R code (e.g. finalDf, timingDf, bothVisitIds, percMajority) CDM table names (e.g. cdm$preg_hip_records, cdm$outcome_episodes_df, cdm$matcho_outcome_limits) Column names data frames lazy tbls (e.g. person_id, final_episode_start_date, final_outcome_category) building tibbles lists define row/column structure, use snake_case names become column names (e.g. list(inferred_start_date = x, precision_days = y)). Output file names written outputDir (e.g. hip_episodes.rds, pps_episodes.rds, hipps_episodes.rds, esd.rds, final_pregnancy_episodes.rds). Use lowercase behavior consistent case-sensitive (e.g. Linux, CI) case-insensitive (e.g. macOS) filesystems avoid bugs mismatched casing tests downstream code.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/algorithm.html","id":"running-the-full-pipeline","dir":"Articles","previous_headings":"","what":"Running the full pipeline","title":"PregnancyIdentifier pipeline overview","text":"primary entry point runPregnancyIdentifier(), runs steps end--end writes intermediate artifacts final outputs outputDir.","code":"library(PregnancyIdentifier) library(CDMConnector)  # A cdm_reference from CDMConnector (e.g. mock or real CDM) cdm <- mockPregnancyCdm()  runPregnancyIdentifier(   cdm           = cdm,   outputDir     = \"pregnancy_identifier_output\",   startDate     = as.Date(\"2000-01-01\"),   endDate       = Sys.Date(),   justGestation = TRUE,   minCellCount  = 5L )"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/algorithm.html","id":"outputs-written-to-disk","dir":"Articles","previous_headings":"Running the full pipeline","what":"Outputs written to disk","title":"PregnancyIdentifier pipeline overview","text":"pipeline writes intermediate RDS artifacts proceeds finishes patient-level episode table plus optional shareable exports:","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/algorithm.html","id":"pipeline-steps-in-order","dir":"Articles","previous_headings":"","what":"Pipeline steps in order","title":"PregnancyIdentifier pipeline overview","text":"initPregnancies — Loads pregnancy concept sets CDM, builds preg_hip_records preg_pps_records condition, procedure, observation, measurement tables within study window. runHip — Builds outcome episodes, gestation episodes, merges cleans , writes hip_episodes.rds. runPps — Builds PPS episodes pregnancy-related concepts, assigns outcomes, writes pps_episodes.rds. mergeHipps — Reads hip_episodes.rds pps_episodes.rds, merges temporal overlap, deduplicates many--many matches, writes hipps_episodes.rds. runEsd — Reads hipps_episodes.rds, pulls gestational timing concepts (GW/GR3m), infers start dates precision, harmonizes end outcome HIP vs PPS, writes final_pregnancy_episodes.rds. exportPregnancies — (Optional) Reads final_pregnancy_episodes.rds writes shareable CSVs ZIP exportDir. See Export vignette.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/algorithm.html","id":"what-each-step-contributes-to-final-start-end-and-outcome","dir":"Articles","previous_headings":"","what":"What each step contributes to final start, end, and outcome","title":"PregnancyIdentifier pipeline overview","text":"pipeline’s important analysis variables final_episode_start_date, final_episode_end_date, final_outcome_category. step contributes . : final start comes ESD (GW/GR3m inference end − max_term). Final end final outcome come ESD’s choice HIP PPS; merge puts values row ESD can pick one.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/algorithm.html","id":"interpreting-the-final-episode-table","dir":"Articles","previous_headings":"","what":"Interpreting the final episode table","title":"PregnancyIdentifier pipeline overview","text":"primary analysis dataset final_pregnancy_episodes.rds, one row per pregnancy episode. Key fields include: final_episode_start_date — Best estimate pregnancy start episode. Set ESD: ESD gestational timing (GW /GR3m) within merged evidence window, start inferred (e.g. concept_date − 7×weeks GW, GR3m midpoint). ESD inferred start, set final_episode_end_date − max_term (Matcho term chosen outcome, e.g. 301 days live birth). final_episode_end_date — Best estimate pregnancy end episode. taken merged interval (merge_episode_end). Set ESD picking one hip_end_date pps_end_date: HIP PPS agree (outcome end within 14 days), ESD uses hip_end_date; one side missing, ESD uses side present; disagree, ESD uses rules (e.g. take one occurs second, HIP timing similar). See ESD vignette full logic. final_outcome_category — Outcome category episode (e.g. LB, SB, PREG). Set ESD picking one hip_outcome_category pps_outcome_category using priority rules end date. Together, final_episode_start_date, final_episode_end_date, final_outcome_category primary analysis variables: pipeline’s final inferred pregnancy interval outcome. merge_episode_start — Start evidence window episode merge step. minimum : HIP’s first gestation date episode, PPS episode min date, HIP estimated start. earliest date implied either algorithm merged episode. merge_episode_end — End evidence window episode merge step. maximum : PPS episode max date HIP pregnancy end (visit/outcome date). latest date implied either algorithm merged episode. merge_episode_start merge_episode_end describe span raw evidence (HIP + PPS) merged episode, ESD refines start/end inferred interval. hip_end_date — Episode end date HIP algorithm: either outcome date (e.g. delivery) latest gestation date outcome. NA episode found PPS (overlapping HIP episode). pps_end_date — Episode end PPS algorithm: inferred outcome date PPS assigned outcome (LB, SB, etc.), otherwise PPS episode max date. NA episode found HIP (overlapping PPS episode). hip_end_date pps_end_date end dates produced algorithm; least one non-NA algorithms contributed episode, one NA one-sided (HIP-PPS-) episodes.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/algorithm.html","id":"an-example-case","dir":"Articles","previous_headings":"","what":"An example case","title":"PregnancyIdentifier pipeline overview","text":"","code":"library(PregnancyIdentifier) library(CDMConnector) library(dplyr, warn.conflicts = FALSE)  cdm <- mockPregnancyCdm() #>  #> Download completed!  cdm <- cdmSubset(cdm, personId = 24)  cdm %>%    cdmFlatten() %>%    select(-\"type_concept_id\", -\"domain\") %>%    arrange(start_date) #> # Source:     SQL [?? x 6] #> # Database:   DuckDB 1.4.4 [unknown@Linux 6.14.0-1017-azure:R 4.5.2//tmp/RtmpwmywbM/file225f5f6e4c7b.duckdb] #> # Ordered by: start_date #>   person_id observation_concept_id start_date end_date observation_concept_name  #>       <int>                  <int> <date>     <date>   <chr>                     #> 1        24                4132434 2023-03-15 NA       Gestation period, 8 weeks #> 2        24                 437611 2023-03-15 NA       Ectopic pregnancy         #> 3        24                4094910 2023-01-28 NA       Pregnancy test positive   #> # ℹ 1 more variable: type_concept_name <chr> outputDir <- file.path(tempdir(), \"pregnancy_output\")  invisible(capture.output(   runPregnancyIdentifier(cdm, outputDir = outputDir) ))  list.files(outputDir) #> [1] \"attrition.csv\"                \"final_pregnancy_episodes.rds\" #> [3] \"hip_episodes.rds\"             \"hipps_episodes.rds\"           #> [5] \"log.txt\"                      \"pps_concept_counts.csv\"       #> [7] \"pps_episodes.rds\"             \"runStart.csv\" readRDS(file.path(outputDir, \"final_pregnancy_episodes.rds\")) #> # A tibble: 1 × 39 #>   person_id merge_episode_number final_episode_start_date final_episode_end_date #>       <int>                <int> <date>                   <date>                 #> 1        24                    1 2023-01-18               2023-03-15             #> # ℹ 35 more variables: final_outcome_category <chr>, #> #   merge_episode_start <date>, merge_episode_end <date>, hip_end_date <date>, #> #   pps_end_date <date>, hip_outcome_category <chr>, #> #   pps_outcome_category <chr>, esd_precision_days <dbl>, #> #   esd_precision_category <chr>, esd_gestational_age_days_calculated <int>, #> #   esd_gw_flag <dbl>, esd_gr3m_flag <dbl>, esd_outcome_match <dbl>, #> #   esd_term_duration_flag <dbl>, esd_outcome_concordance_score <dbl>, …"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/esd.html","id":"overview","dir":"Articles","previous_headings":"","what":"Overview","title":"ESD algorithm","text":"Episode construction (HIP, PPS, merge) yields plausible pregnancy intervals, start dates can remain uncertain. ESD (Episode Start Date) step refines episode starts extracting gestational timing evidence recorded HIPPS episode converting evidence : final_episode_start_date — Inferred pregnancy start date (written output; internally inferred_episode_start) final_episode_end_date — Resolved episode end: taken merged episode interval; ESD re-derives picking hip_end_date pps_end_date (see ). esd_precision_days esd_precision_category — Uncertainty days binned precision label (e.g. week, month, three-month) Plausibility concordance metrics: esd_term_duration_flag, esd_outcome_concordance_score, esd_outcome_match, esd_preterm_status_from_calculation, etc. ESD run via runEsd(), reads hipps_episodes.rds outputDir, pulls gestational timing concepts CDM, infers start dates precision, merges ESD results back onto HIPPS metadata (including resolving final outcome end date HIP PPS disagree), writes final_pregnancy_episodes.rds outputDir. Optionally, debugMode = TRUE, also writes esd.rds (episode-level start inference , merging back). Important: final episode end date final outcome category pipeline taken merged episode (e.g. merge_episode_end). re-derived ESD picking HIP PPS : ESD compares hip_end_date pps_end_date (hip_outcome_category pps_outcome_category) applies harmonization rules choose one end one outcome per episode. merged interval used define evidence window start inference; reported end outcome come second pass HIP PPS.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/esd.html","id":"relationship-to-hip-pps-and-merge","dir":"Articles","previous_headings":"","what":"Relationship to HIP, PPS, and merge","title":"ESD algorithm","text":"HIP PPS already use gestational-age concepts, merge step combines episodes one table merge_episode_start merge_episode_end. reasonable ask ESD exists uses merged data versus HIP PPS directly. earlier steps . HIP uses gestation build outcome-anchored episodes estimate start outcome + term ranges; outputs hip_pregnancy_start, hip_end_date (e.g. delivery date), hip_outcome_category. PPS uses pregnancy-related concepts gestational timing windows (min/month ranges) define episode bounds; outputs pps_episode_min_date, pps_episode_max_date, pps_outcome_category. merge step matches HIP PPS episodes temporal overlap produces one row per merged episode, merge_episode_start = min relevant HIP/PPS starts merge_episode_end = max relevant HIP/PPS ends. merge already one interval per episode. ESD adds. ESD two things: Refine start add precision. HIP PPS (merge) give bounds estimated start. ESD goes back CDM , merged episode, pulls gestational timing concepts (GW GR3m) fall within episode’s merged interval. concepts computes single inferred_episode_start (e.g. concept_date − 7×weeks “18 weeks”) precision_days / precision_category (week vs month vs three-month). ESD answers: “episode already , best point estimate pregnancy start precise ?” single start plus precision produced HIP PPS form. Harmonize end outcome HIP PPS disagree. merge keeps one row per episode preserves hip_end_date / hip_outcome_category pps_end_date / pps_outcome_category row. ESD use merge_episode_end final episode end. Instead re-compares hip_end_date pps_end_date (two outcomes) applies rules (e.g. outcome match within 14 days, “take one occurs second”) set final_episode_end_date (internally inferred_episode_end) final_outcome_category. reported end outcome chosen raw HIP PPS values, merged interval. can seem redundant merge, makes final end outcome explicit consistent rules used concordance metrics. ESD uses merged data vs HIP/PPS. : gestational-style concepts used HIP, PPS, ESD—ESD uses produce single start date precision episode already exists merge. final end/outcome resolved HIP PPS one end one outcome chosen explicitly per episode.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/esd.html","id":"how-final-start-end-and-outcome-are-chosen","dir":"Articles","previous_headings":"","what":"How final start, end, and outcome are chosen","title":"ESD algorithm","text":"ESD sets final_episode_start_date (inferred_episode_start), final_episode_end_date (inferred_episode_end), final_outcome_category using following logic. end outcome always chosen hip_end_date / hip_outcome_category pps_end_date / pps_outcome_category merged row; merge_episode_end used final end.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/esd.html","id":"final-start-date","dir":"Articles","previous_headings":"How final start, end, and outcome are chosen","what":"Final start date","title":"ESD algorithm","text":"ESD gestational timing evidence (GW /GR3m) within merged evidence window: start inferred evidence (see Two types gestational timing evidence) — e.g. concept_date − 7×weeks “gestation 18 weeks” concept, midpoint GR3m intersection. One date chosen per episode stored inferred_episode_start. ESD inferred start: start set inferred_episode_end − max_term, max_term maximum gestational days chosen outcome category Matcho term-duration table (e.g. 301 days live birth). start back-calculated final end outcome’s expected maximum duration.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/esd.html","id":"final-end-date-and-outcome-category","dir":"Articles","previous_headings":"How final start, end, and outcome are chosen","what":"Final end date and outcome category","title":"ESD algorithm","text":"ESD first computes outcome_match: 1 HIP PPS agree (outcome category end dates within 14 days, PREG), else 0. chooses final_outcome_category inferred_episode_end using priority order: outcome_match == 1 — Use HIP: final_outcome_category = hip_outcome_category, inferred_episode_end = hip_end_date. One-sided (HIP PPS) — Use side present: pps_outcome_category NA, use HIP; hip_outcome_category NA, use PPS. PPS outcome equals next HIP outcome (person) hip_end_date ≤ pps_end_date − 14 days: use HIP (PPS treated later episode). Else hip_end_date ≤ pps_end_date − 7 days: use PPS (HIP end least 7 days PPS end). Else: use HIP (similar timing). Fallback — rule applied: use hip_end_date / hip_outcome_category non-NA, else pps_end_date / pps_outcome_category. final end outcome always one two algorithm values row; ESD never uses merge_episode_end reported end.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/esd.html","id":"inputs","dir":"Articles","previous_headings":"","what":"Inputs","title":"ESD algorithm","text":"cdm — CDM reference (concept domain tables). outputDir — Directory containing hipps_episodes.rds (produced mergeHipps()). startDate, endDate — Study window filtering concept dates. logger — Optional log4r logger.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/esd.html","id":"two-types-of-gestational-timing-evidence","dir":"Articles","previous_headings":"","what":"Two types of gestational timing evidence","title":"ESD algorithm","text":"ESD classifies evidence two types: GW (“gestation week”) — Week-based gestational age concepts whose name contains “gestation period” “gestational age”, whose concept ID gestational_age_concepts.csv ESD_concepts2.xlsx. Values parsed record (e.g. “Gestation period, 18 weeks” numeric value); values 1 44 weeks kept. algorithm extrapolates single start date: concept_date − 7×weeks. multiple GW values exist, removeGWOutliers() keeps dates whose distance median (days) lies within IQR×1.5 range. GR3m (“gestational range ≤ 3 months”) — Concepts min_month max_month PPS concept table (preg_pps_concepts, PPS_concepts_reviewed1702026.xlsx). imply plausible start-date interval: concept_date − max_days concept_date − min_days, days = months×30.4. multiple GR3m intervals exist, findIntersection() first drops outlier intervals (overlap count, IQR×1.5), computes intersection remaining intervals. inferred start GR3m-episodes midpoint intersection. GW GR3m evidence exist, ESD checks whether GW-extrapolated date falls inside GR3m intersection (optionally widening interval < 7 days: midpoint ± 3 days). 50% GW concepts overlap GR3m intersection, ESD uses overlapping GW dates (outlier removal) start; otherwise uses GW dates (outlier removal). chosen inferred start first filtered GW list, ordered highest gestational week lowest (.e. latest--pregnancy estimate). precision_days spread (max − min) filtered GW dates, −1 single GW (stored category week_poor-support).","code":""},{"path":[]},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/esd.html","id":"gettimingconcepts-for-each-hipps-episode-builds-a-person-level-list-of-person_id-merge_episode_number-date-range--pulls-pregnancy-related-concepts-from-condition_occurrence-observation-measurement-and-procedure_occurrence-that-fall-within-each-episodes-evidence-window-normalized-to-a-common-schema-e-g--domain_concept_id-domain_concept_start_date-value_col--joins-to-esdpps-concept-tables-to-get-min_month-max_month-and-to-classify-concepts-as-gw-or-gr3m-","dir":"Articles","previous_headings":"Main stages (internal logic)","what":"1. getTimingConcepts — For each HIPPS episode, builds a person-level list of (person_id, merge_episode_number, date range). Pulls pregnancy-related concepts from condition_occurrence, observation, measurement, and procedure_occurrence that fall within each episode’s evidence window, normalized to a common schema (e.g. domain_concept_id, domain_concept_start_date, value_col). Joins to ESD/PPS concept tables to get min_month, max_month and to classify concepts as GW or GR3m.","title":"ESD algorithm","text":"episodesWithGestationalTimingInfo — episode (person_id, merge_episode_number), aggregates concept evidence : single “all_gt_info” string (GW dates GR3m “max_pregnancy_start min_pregnancy_start” ranges), Flags: gw_flag, gr3m_flag, inferred_start_date (single best start date), precision_days (spread days -1 single GW), precision_category (e.g. week, month, three-month), intervals_count, majority_overlap_count (logging/QA). getGtTiming implements GW/GR3m combination logic: GR3m intersection exists, checks whether GW concepts overlap intersection; GW GR3m exists, uses appropriate single source. mergedEpisodesWithMetadata — Joins ESD timing output (inferred start, precision_days, precision_category, etc.; renamed final_episode_start_date, final_episode_end_date, esd_* write) back onto HIPPS episodes. Harmonizes final_outcome_category inferred episode end HIP vs PPS disagree (e.g. prioritizing outcome occurs second one better date concordance). Adds: esd_gestational_age_days_calculated (inferred end − inferred start), esd_term_duration_flag (whether duration falls expected term range outcome), esd_outcome_concordance_score, esd_preterm_status_from_calculation, etc. deduplicates one row per (person_id, inferred_episode_end, final_outcome_category) .keep_all = TRUE columns (e.g. hip_end_date, pps_end_date) retained export. Study period filter — Keeps rows inferred episode start startDate inferred episode end endDate (episodes missing dates retained). Write — Saves final data frame final_pregnancy_episodes.rds outputDir. debugMode = TRUE, esd.rds written step 2 (episode-level start inference ).","code":""},{"path":[]},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/esd.html","id":"running-esd","dir":"Articles","previous_headings":"","what":"Running ESD","title":"ESD algorithm","text":"ESD normally run step 5 runPregnancyIdentifier(). run alone (e.g. debugging), ensure outputDir already contains hipps_episodes.rds: full pipeline, use runPregnancyIdentifier(); see pipeline overview.","code":"library(PregnancyIdentifier) cdm <- mockPregnancyCdm() # ... run initPregnancies, runHip, runPps, mergeHipps so that outputDir contains hipps_episodes.rds ...  runEsd(   cdm       = cdm,   outputDir = \"pregnancy_output\",   startDate = as.Date(\"2000-01-01\"),   endDate   = Sys.Date(),   logger    = makeLogger(\"pregnancy_output\"),   debugMode = FALSE ) # final_pregnancy_episodes.rds is written to pregnancy_output/"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"overview","dir":"Articles","previous_headings":"","what":"Overview","title":"Export: shareable summary CSVs","text":"pipeline produced final_pregnancy_episodes.rds (see ESD vignette), export step turns results related artifacts shareable CSV files QA cross-site comparison. Export run via exportPregnancies() writes CSVs (ZIP archive) export directory. Small cell counts can suppressed using minCellCount. vignette lists every exported CSV: file name, columns, meaning column, file used analysis.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"how-to-run-export","dir":"Articles","previous_headings":"","what":"How to run export","title":"Export: shareable summary CSVs","text":"Export optional. Run full pipeline (ensure outputDir already contains final_pregnancy_episodes.rds runStart.csv): use runPregnancyIdentifier(..., runExport = TRUE) export runs automatically ESD.","code":"library(PregnancyIdentifier) cdm <- mockPregnancyCdm() runPregnancyIdentifier(cdm, outputDir = \"out\", runExport = FALSE) # Then run export explicitly: exportPregnancies(   cdm       = cdm,   outputDir = \"out\",   exportDir = \"out/export\",   minCellCount = 5L )"},{"path":[]},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"cdm_source-csv","dir":"Articles","previous_headings":"Exported files: metadata and copied artifacts","what":"cdm_source.csv","title":"Export: shareable summary CSVs","text":"Source: CDMConnector::snapshot(cdm) — one row CDM metadata. Columns: Depend CDMConnector version; typically include identifiers timestamps CDM (e.g. cdm_name, snapshot_date, snapshot fields). Purpose: Documents CDM snapshot export came . Used comparing aggregating exports across sites runs can track provenance CDM version.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"pps_concept_counts-csv","dir":"Articles","previous_headings":"Exported files: metadata and copied artifacts","what":"pps_concept_counts.csv","title":"Export: shareable summary CSVs","text":"Source: Copied outputDir (written PPS step runPps()). Content: Counts pregnancy-related concepts used PPS per concept (e.g. concept_id, concept name, count records). Purpose: Describes PPS concept usage run. Used compare concept coverage across sites check expected pregnancy concepts present.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"log-txt","dir":"Articles","previous_headings":"Exported files: metadata and copied artifacts","what":"log.txt","title":"Export: shareable summary CSVs","text":"Source: Copied outputDir (pipeline log makeLogger()). Content: Plain-text log pipeline steps (init, HIP, PPS, merge, ESD). Purpose: Audit trail run. Used debugging verify steps ran .","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"exported-files-derived-from-final_pregnancy_episodes-rds","dir":"Articles","previous_headings":"","what":"Exported files: derived from final_pregnancy_episodes.rds","title":"Export: shareable summary CSVs","text":"following computed final_pregnancy_episodes.rds share common metadata columns present: cdm_name, date_run (pipeline run timestamp), date_export (export/snapshot date), pkg_version (PregnancyIdentifier version). Counts range (0, minCellCount) may replaced NA disclosure control.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"age_summary-csv","dir":"Articles","previous_headings":"Exported files: derived from final_pregnancy_episodes.rds","what":"age_summary.csv","title":"Export: shareable summary CSVs","text":"Columns: Summary age_pregnancy_start (age years pregnancy start): colName, min, Q25, median, Q75, max, mean, sd, plus cdm_name, date_run, date_export, pkg_version. Purpose: Describes distribution maternal age pregnancy start. Used cohort description, feasibility checks, comparing age distributions across sites time windows.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"age_summary_groups-csv","dir":"Articles","previous_headings":"Exported files: derived from final_pregnancy_episodes.rds","what":"age_summary_groups.csv","title":"Export: shareable summary CSVs","text":"Columns: colName, age_pregnancy_start (value group: integer year \"<12\", \">55\"), n, total, pct, plus metadata. Counts may suppressed minCellCount. Purpose: Counts percentages pregnancies age (year boundary groups <12 >55). Used age-stratified summaries checking extreme-age pregnancy counts.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"precision_days-csv","dir":"Articles","previous_headings":"Exported files: derived from final_pregnancy_episodes.rds","what":"precision_days.csv","title":"Export: shareable summary CSVs","text":"Columns: esd_precision_days (x-axis values), density (kernel density estimate), plus cdm_name, date_run, date_export, pkg_version. Purpose: Distribution ESD start-date precision (days). Used see precise inferred start dates (e.g. mostly week-level vs month-level) compare precision across sites.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"episode_frequency-csv","dir":"Articles","previous_headings":"Exported files: derived from final_pregnancy_episodes.rds","what":"episode_frequency.csv","title":"Export: shareable summary CSVs","text":"Columns: total_episodes, total_individuals (distinct persons least one episode), plus metadata. total_individuals may suppressed < minCellCount. Purpose: High-level counts: many pregnancy episodes many people. Used main denominator rates site-level summaries.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"pregnancy_frequency-csv","dir":"Articles","previous_headings":"Exported files: derived from final_pregnancy_episodes.rds","what":"pregnancy_frequency.csv","title":"Export: shareable summary CSVs","text":"Columns: freq (number pregnancies per person: 1, 2, 3, …), number_individuals (count persons frequency), plus metadata. number_individuals may suppressed. Purpose: Distribution pregnancy count per person (parity-like). Used describe repeat pregnancies check implausible multiplicity.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"episode_frequency_summary-csv","dir":"Articles","previous_headings":"Exported files: derived from final_pregnancy_episodes.rds","what":"episode_frequency_summary.csv","title":"Export: shareable summary CSVs","text":"Columns: Summary freq (episodes per person): colName, min, Q25, median, Q75, max, mean, sd, plus metadata. Purpose: Numeric summary many episodes per person (min/median/max, etc.). Used cohort description cross-site comparison pregnancy frequency.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"gestational_age_days_summary-csv","dir":"Articles","previous_headings":"Exported files: derived from final_pregnancy_episodes.rds","what":"gestational_age_days_summary.csv","title":"Export: shareable summary CSVs","text":"Columns: Summary esd_gestational_age_days_calculated (gestational length days): colName, min, Q25, median, Q75, max, mean, sd, plus metadata. Purpose: Distribution gestational duration. Used describe pregnancy length, flag implausible durations, compare sites.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"gestational_age_days_counts-csv","dir":"Articles","previous_headings":"Exported files: derived from final_pregnancy_episodes.rds","what":"gestational_age_days_counts.csv","title":"Export: shareable summary CSVs","text":"Columns: less_1day (count episodes gestational age < 1 day), over_308days (count > 308 days), plus metadata. Purpose: Counts --range gestational ages. Used data quality quantify implausible missing duration.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"gestational_weeks-csv","dir":"Articles","previous_headings":"Exported files: derived from final_pregnancy_episodes.rds","what":"gestational_weeks.csv","title":"Export: shareable summary CSVs","text":"Columns: gestational_weeks (integer: floor gestational age days / 7), n (number episodes), pct (percentage), plus metadata. Purpose: Distribution gestational age week. Used gestational-age histograms, preterm/term summaries, cross-site comparison.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"gestational_age_days_per_category_summary-csv","dir":"Articles","previous_headings":"Exported files: derived from final_pregnancy_episodes.rds","what":"gestational_age_days_per_category_summary.csv","title":"Export: shareable summary CSVs","text":"Columns: One row per final_outcome_category (e.g. LB, SB, PREG). : summary esd_gestational_age_days_calculated — colName, min, Q25, median, Q75, max, mean, sd, plus final_outcome_category metadata. Purpose: Gestational duration outcome type. Used check outcome-specific durations (e.g. live birth vs miscarriage) plausible compare across sites.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"yearly_trend-csv","dir":"Articles","previous_headings":"Exported files: derived from final_pregnancy_episodes.rds","what":"yearly_trend.csv","title":"Export: shareable summary CSVs","text":"Columns: column (name date field), year (integer), count (number episodes date year), plus metadata. Purpose: Episode counts year date type (e.g. final_episode_start_date, final_episode_end_date). Used temporal trends study window checks.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"yearly_trend_missing-csv","dir":"Articles","previous_headings":"Exported files: derived from final_pregnancy_episodes.rds","what":"yearly_trend_missing.csv","title":"Export: shareable summary CSVs","text":"Columns: yearly_trend rows year NA (missing date). Purpose: Count episodes missing dates column. Used completeness missing-data reporting.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"monthly_trends-csv","dir":"Articles","previous_headings":"Exported files: derived from final_pregnancy_episodes.rds","what":"monthly_trends.csv","title":"Export: shareable summary CSVs","text":"Columns: column (date field), month (month name), count, plus metadata. Purpose: Episode counts month (seasonality). Used seasonal patterns data completeness month.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"monthly_trend_missing-csv","dir":"Articles","previous_headings":"Exported files: derived from final_pregnancy_episodes.rds","what":"monthly_trend_missing.csv","title":"Export: shareable summary CSVs","text":"Columns: monthly_trends rows month NA. Purpose: Count episodes missing date column, completeness.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"observation_period_range-csv","dir":"Articles","previous_headings":"Exported files: derived from final_pregnancy_episodes.rds","what":"observation_period_range.csv","title":"Export: shareable summary CSVs","text":"Columns: min_obs (minimum observation period start year), max_obs (maximum observation period end year), plus metadata. Derived CDM observation_period. Purpose: Range observation periods CDM. Used interpret temporal coverage compare study windows across sites.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"pregnancy_overlap_counts-csv","dir":"Articles","previous_headings":"Exported files: derived from final_pregnancy_episodes.rds","what":"pregnancy_overlap_counts.csv","title":"Export: shareable summary CSVs","text":"Columns: Summary overlap (logical: whether episode’s start ≤ previous episode’s end person): colName, overlap (TRUE/FALSE), n, total, pct, plus metadata. persons one episode considered. Purpose: Count persons overlapping inferred pregnancy intervals. Used data quality (overlaps may indicate algorithm data issues).","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"date_consistency-csv","dir":"Articles","previous_headings":"Exported files: derived from final_pregnancy_episodes.rds","what":"date_consistency.csv","title":"Export: shareable summary CSVs","text":"Columns: One column per date field (merge_pregnancy_start, hip_end_date, pps_end_date, merge_episode_start, merge_episode_end, final_episode_start_date, final_episode_end_date, etc.). value proportion episodes NA date (0–1). Plus metadata. Purpose: Proportion missing dates field. Used assess completeness key dates compare across sites.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"swapped_dates-csv","dir":"Articles","previous_headings":"Exported files: derived from final_pregnancy_episodes.rds","what":"swapped_dates.csv","title":"Export: shareable summary CSVs","text":"Columns: n_rev_hip (count merge_pregnancy_start > hip_end_date), n_rev_pps (count merge_pregnancy_start > pps_end_date), plus metadata. Purpose: Count episodes reversed start/end (start end). Used data quality algorithm validation.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"outcome_categories_count-csv","dir":"Articles","previous_headings":"Exported files: derived from final_pregnancy_episodes.rds","what":"outcome_categories_count.csv","title":"Export: shareable summary CSVs","text":"Columns: outcome_category (e.g. LB, SB, PREG), algorithm (hip, pps, hipps), n, pct (within algorithm), plus metadata. Purpose: Outcome distribution algorithm (HIP, PPS, final harmonized). Used compare algorithm agreement describe outcome mix across sites.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/export.html","id":"zip-archive","dir":"Articles","previous_headings":"","what":"ZIP archive","title":"Export: shareable summary CSVs","text":"writing CSVs (copying log.txt), exportPregnancies() creates ZIP file export directory. name form {snapshot_date}-{pkg_version}-{cdm_name}-results.zip contains files directory. Use single archive share archive full export.","code":""},{"path":[]},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/hip.html","id":"overview","dir":"Articles","previous_headings":"","what":"Overview","title":"HIP algorithm","text":"HIP (outcome-anchored) algorithm identifies pregnancy episodes combining high-specificity pregnancy outcomes (e.g., live birth, stillbirth, abortion) gestational-age evidence (weeks gestation) available. produces one record per inferred pregnancy, including episode end date (hip_pregnancy_end), estimated start date (hip_pregnancy_start), pregnancy category. HIP run via runHip(), assumes initPregnancies() already run CDM contains preg_hip_records preg_hip_concepts. HIP writes hip_episodes.rds outputDir adds internal table cdm$preg_hip_episodes execution.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/hip.html","id":"two-pass-structure","dir":"Articles","previous_headings":"","what":"Two-pass structure","title":"HIP algorithm","text":"HIP runs two conceptual passes: Outcome-first pass (high specificity): Treat recorded pregnancy outcomes anchor (pregnancy “end”), infer plausible start dates using outcome-specific gestational duration ranges (Matcho term durations). Gestation pass (higher sensitivity): Group gestational-age records pregnancy episodes pregnancies may recorded outcome, merge episodes outcome-based episodes resolve conflicts. result single episode table can include: Pregnancies outcome evidence (outcome anchors end date). Pregnancies gestation evidence (optionally included via justGestation = TRUE). Pregnancies sources reinforce one another.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/hip.html","id":"what-hip-is-trying-to-solve","dir":"Articles","previous_headings":"","what":"What HIP is trying to solve","title":"HIP algorithm","text":"Observational data commonly contains: Multiple outcome records pregnancy (duplicate coding, follow-visits). Outcome records close together may represent episode distinct pregnancies depending spacing. Pregnancies explicit outcome gestational age documentation (ultrasound, prenatal visits). Conflicts outcome timing gestational timing (e.g., gestational evidence implies implausible duration). HIP addresses : Enforcing minimum spacing rules outcomes (Matcho outcome limits) pregnancies -counted. Inferring start dates using outcome-specific term ranges (min/max gestational days per category). Using gestational-age trajectories detect pregnancies outcomes miss attach gestation-episodes justGestation TRUE.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/hip.html","id":"main-stages-internal-logic","dir":"Articles","previous_headings":"","what":"Main stages (internal logic)","title":"HIP algorithm","text":"Matcho outcome limits — table minimum spacing (days) consecutive outcome categories inserted CDM used decide two outcome visits belong vs. different pregnancies. Build final outcome visits — outcome category group (AB/SA, DELIV, ECT, SB, LB), HIP builds candidate outcome visits preg_hip_records, applies spacing rules, produces list final visit tables (e.g. finalLbVisits, finalSbVisits). Build outcome episodes — final visit tables combined single outcome-episode table (outcome_episodes_df) person_id, outcome_category, outcome_date, outcome_id. Outcome categories ordered (e.g. LB, SB, ECT, AB/SA, DELIV) spacing categories enforced using Matcho limits. Estimate outcome starts — outcome episode joined Matcho term durations get min_term max_term (gestational days). , HIP derives min_start_date max_start_date inferred pregnancy interval. Build gestation episodes — preg_hip_records, HIP builds gestation-based episodes (grouped person visit/gestational evidence), computes max/min gest dates gest weeks, stores gest_episodes_df. Merge outcome gestation — Outcome episodes (start bounds) gestation episodes joined person overlapping intervals. person, episodes classified : () outcome gestation, (b) outcome , (c) gestation (justGestation). unioned merged_episodes_df. Clean resolve overlaps — Merged episodes cleaned (e.g. reclassify implausible term durations PREG, set removed_outcome), overlapping PREG gestation episodes resolved final episode single final_start_date duplicate overlap. Attach gestation length — Final episodes joined gestation visit-level data attach gest_flag episode_length, producing preg_hip_episodes. table collected saved hip_episodes.rds.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/hip.html","id":"hip-outputs-and-categories","dir":"Articles","previous_headings":"","what":"HIP outputs and categories","title":"HIP algorithm","text":"HIP episodes include: person_id — Unique person identifier. hip_first_gest_date — First gestation date episode (NA gestational visit episode window). hip_pregnancy_end — Episode end date (outcome date max gest date). hip_pregnancy_start — Inferred pregnancy start date. category — One : LB, SB, AB, SA, DELIV, ECT, PREG. gest_flag — Whether gestational evidence supported episode. episode_length — Duration measure episode. episode — Within-person episode number. Interpretation categories: LB — Live birth outcome anchors episode end. SB — Stillbirth. AB — Abortion. SA — Miscarriage (spontaneous abortion). DELIV — Delivery record present classified LB/SB. ECT — Ectopic pregnancy. PREG — Pregnancy inferred gestational evidence without usable outcome anchor (outcome evidence deemed implausible).","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/hip.html","id":"running-hip-alone","dir":"Articles","previous_headings":"","what":"Running HIP alone","title":"HIP algorithm","text":"full pipeline (HIP → PPS → merge → ESD), use runPregnancyIdentifier(); see pipeline overview.","code":"library(PregnancyIdentifier) cdm <- mockPregnancyCdm() logger <- makeLogger(\"hip_output\") cdm <- initPregnancies(cdm, startDate = as.Date(\"2000-01-01\"), endDate = Sys.Date(), ageBounds = c(15L, 56L), logger = logger)  cdm <- runHip(   cdm,   outputDir  = \"hip_output\",   startDate  = as.Date(\"2000-01-01\"),   endDate    = Sys.Date(),   justGestation = TRUE,   logger     = logger ) # hip_episodes.rds is written to hip_output/"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/merge.html","id":"what-the-merge-does","dir":"Articles","previous_headings":"","what":"What the merge does","title":"Merging HIP and PPS episodes into HIPPS","text":"merge takes two episode tables—one HIP one PPS—produces one table one row per pregnancy episode per person. person: Overlap join: HIP PPS episodes matched within person temporal overlap intervals. Episodes overlap become candidate merged rows; episodes overlap kept one-sided rows (HIP-PPS-). Many--many: One HIP episode can overlap several PPS episodes, one PPS episode can overlap several HIP episodes. resolve , merge deduplicates overlapping episodes selecting single best HIP–PPS pair episode identifier. episode identifier defined unique combination person algorithm source: HIP episodes, identifier hip_episode_id = {person_id}_{hip_episode}_hip, PPS episodes, pps_episode_id = {person_id}_{pps_episode_number}_pps. merged table keeps one matched pair unique combination identifiers, ensuring episode represented output. Final table: Merged dates outcome fields standardized, episodes ordered within person. result written hipps_episodes.rds. rows dropped except duplicate overlap candidates; one-sided episodes one--one matches preserved. Point merge. merge serves three purposes rest pipeline: Define episodes exist — One row per episode overlap deduplication. set episodes (identity) fixed . Put HIP PPS row — row carries hip_end_date / hip_outcome_category pps_end_date / pps_outcome_category (present). next step, ESD, another overlap-merge HIP PPS; takes single row picks one end date one outcome two values already row using harmonization rules. Supply evidence window — merge_episode_start merge_episode_end define interval ESD uses pull gestational timing concepts (GW/GR3m) CDM inferring pregnancy start. final episode end date outcome pipeline taken merged interval—chosen ESD hip_end_date pps_end_date (two outcomes). See ESD vignette ESD chooses final start, end, outcome.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/merge.html","id":"inputs","dir":"Articles","previous_headings":"","what":"Inputs","title":"Merging HIP and PPS episodes into HIPPS","text":"mergeHipps(outputDir, logger) reads outputDir:","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/merge.html","id":"stage-1-standardized-episode-intervals-and-ids","dir":"Articles","previous_headings":"","what":"Stage 1: Standardized episode intervals and IDs","title":"Merging HIP and PPS episodes into HIPPS","text":"HIP PPS use different date columns. merge standardizes common interval names adds stable identifiers. HIP (algorithm 1) - pregnancy_start = hip_pregnancy_start (internal); output hip_episode, hip_outcome_category, etc. - pregnancy_end = hip_pregnancy_end (HIP episode end) - first_gest_date = hip_first_gest_date (first gestation date episode) - hip_episode_id = {person_id}_{hip_episode}_hip PPS (algorithm 2) - pps_episode_min_date = start PPS episode evidence - pps_episode_max_date_plus_two_months = PPS episode end extended two months (allows delayed outcome capture) - pps_episode_id = {person_id}_{pps_episode_number}_pps Overlap computed : HIP: [pregnancy_start, pregnancy_end] PPS: [pps_episode_min_date, pps_episode_max_date_plus_two_months]","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/merge.html","id":"stage-2-merge-by-overlap-full-join","dir":"Articles","previous_headings":"","what":"Stage 2: Merge by overlap (full join)","title":"Merging HIP and PPS episodes into HIPPS","text":"Episodes merged within person using full join overlap: Overlap condition:pregnancy_start <= pps_episode_max_date_plus_two_months andpregnancy_end >= pps_episode_min_date two episodes match intervals intersect (including containment). Rows match: one merged row per (HIP episode, PPS episode) pair. Rows match: HIP-PPS-rows (one side NA) kept via full join. row (matched one-sided), merge computes: merged_episode_start = min(first_gest_date, pps_episode_min_date, pregnancy_start) merged_episode_end = max(pps_episode_max_date, pregnancy_end) merged_episode_length = (merged_episode_end − merged_episode_start) months (days / 30.25) Duplicate flags (used Stage 3): duplicated_hip_episode_id = 1 hip_episode_id appears one row (HIP episode matched multiple PPS). duplicated_pps_episode_id = 1 pps_episode_id appears one row (PPS episode matched multiple HIP).","code":"HIP:  [pregnancy_start ---------------- pregnancy_end] PPS:              [pps_episode_min_date -------- pps_episode_max_date_plus_two_months]                   <-------- overlap ------->"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/merge.html","id":"stage-3-deduplication-loop","dir":"Articles","previous_headings":"","what":"Stage 3: Deduplication loop","title":"Merging HIP and PPS episodes into HIPPS","text":"many HIP PPS episodes overlap, overlap join can produce many--many matches: one HIP episode paired several PPS episodes, /one PPS episode paired several HIP episodes. deduplication step keeps one best match per HIP episode per PPS episode (keeps one--one one-sided rows unchanged).","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/merge.html","id":"split-non-duplicates-vs-duplicates","dir":"Articles","previous_headings":"Stage 3: Deduplication loop","what":"Split: non-duplicates vs duplicates","title":"Merging HIP and PPS episodes into HIPPS","text":"baseKeep: Rows neither episode duplicated:(duplicated_hip_episode_id == 0 & duplicated_pps_episode_id == 0) one-sided (one dup flags NA). left unchanged (one--one matches HIP-PPS-episodes). dupDf: Rows least one side duplicated row overlap (HIP PPS present):(duplicated_hip_episode_id == 1 & pps_episode_id present) (duplicated_pps_episode_id == 1 & hip_episode_id present). rows go “pick best” logic.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/merge.html","id":"scoring-overlap-rows","dir":"Articles","previous_headings":"Stage 3: Deduplication loop","what":"Scoring overlap rows","title":"Merging HIP and PPS episodes into HIPPS","text":"candidate row dupDf, algorithm computes: date_diff = |pregnancy_end − pps_episode_max_date| (days). Smaller values mean HIP PPS agree episode end; best match minimizes . Missing PPS outcome (choosing HIP) selecting best PPS match duplicated HIP episode, rows pps_outcome_category missing penalized: date_diff set large value (10000) chosen match exists. pps_days = |pps_episode_max_date − pps_episode_min_date| (PPS episode length days). Used tie-breaking: PPS episodes longer 310 days treated implausible get pps_days = -1, lose ties. Among plausible episodes, longer PPS duration preferred (larger pps_days wins).","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/merge.html","id":"selection-rule-pick-best","dir":"Articles","previous_headings":"Stage 3: Deduplication loop","what":"Selection rule (“pick best”)","title":"Merging HIP and PPS episodes into HIPPS","text":"set rows share duplicated identifier (e.g. hip_episode_id): Keep rows smallest date_diff. Among ties, keep rows largest pps_days (plausible, longer PPS episodes win). implemented : slice_min(date_diff, n = 1) slice_max(pps_days, n = 1). first round uses with_ties = TRUE (keep ties); later rounds use with_ties = FALSE deterministic single winner.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/merge.html","id":"iterative-loop-why-multiple-rounds","dir":"Articles","previous_headings":"Stage 3: Deduplication loop","what":"Iterative loop (why multiple rounds?)","title":"Merging HIP and PPS episodes into HIPPS","text":"picking best match HIP (hip_episode_id), pps_episode_id values can still appear one row. picking best PPS (pps_episode_id), hip_episode_id values can appear . one round enough. algorithm: Initial pass: dupDf, pick best hip_episode_id (missing-outcome penalty) best pps_episode_id (penalty), combine , recompute duplicated_hip_episode_id duplicated_pps_episode_id set. 4 rounds: pick best hip_episode_id among rows still duplicated_hip_episode_id == 1, best pps_episode_id among rows still duplicated_pps_episode_id == 1; recombine recompute dup flags. round, rows longer duplicated (dup flags 0 NA) retained final table. Final set: baseKeep (unchanged) plus rows non-duplicated last round, distinct(). loop repeatedly reduces duplicate HIP PPS ids overlap row duplicated either side, merges resolved rows non-duplicate rows.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/merge.html","id":"deduplication-example","dir":"Articles","previous_headings":"Stage 3: Deduplication loop","what":"Deduplication example","title":"Merging HIP and PPS episodes into HIPPS","text":"Setup: One HIP episode overlaps two PPS episodes. overlap join 2 rows (HIP 1–PPS 1 HIP 1–PPS 2). duplicated_hip_episode_id == 1 (HIP two rows). Scoring: Pick best hip_episode_id: date_diff; tie-break pps_days. Row HIP1–PPS1 wins (222 > 172). merged table keeps one row HIP episode 1: pair (HIP1, PPS1). Another case: One PPS episode overlaps two HIP episodes. PPS 1 overlaps HIP 1 HIP 2. 2 rows; duplicated_pps_episode_id == 1. pick row smaller |pregnancy_end − pps_episode_max_date| (pps_days tied). chooses single best HIP PPS episode.","code":"Person 100, HIP episode 1:  [2020-01-01 -------- 2020-09-15]  (pregnancy_end = 2020-09-15) Person 100, PPS episode 1:     [2020-02-01 --- 2020-09-10]   (pps_episode_max_date = 2020-09-10) Person 100, PPS episode 2:              [2020-04-01 --- 2020-09-20] Person 200, HIP episode 1: [2020-03-01 -- 2020-10-01] Person 200, HIP episode 2:        [2020-05-01 -- 2020-11-15] Person 200, PPS episode 1:    [2020-04-01 -------- 2020-10-20]"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/merge.html","id":"post-deduplication-standardized-columns","dir":"Articles","previous_headings":"","what":"Post-deduplication: standardized columns","title":"Merging HIP and PPS episodes into HIPPS","text":"deduplication, addMergedEpisodeDetails(): Fills PPS outcome missing: row pps_episode_id pps_outcome_category NA, set pps_outcome_category = \"PREG\" set pps_outcome_date = pps_episode_max_date. Renames final names used output: pregnancy_end → hip_end_date, pps_outcome_date → pps_end_date, merged_episode_start → merge_episode_start, merged_episode_end → merge_episode_end, merged_episode_length → merge_episode_length, pregnancy_start → merge_pregnancy_start, first_gest_date → merge_first_gest_date. HIP supplies hip_outcome_category; PPS outcome column remains pps_outcome_category. Adds hip_flag (1 row HIP episode, 0 otherwise) pps_flag (1 PPS episode, 0 otherwise). Recomputes merged episode dates retained rows, orders episodes within person merge_episode_start assigns merge_episode_number (1, 2, 3, … per person).","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/merge.html","id":"output-file-hipps_episodes-rds","dir":"Articles","previous_headings":"","what":"Output file: hipps_episodes.rds","title":"Merging HIP and PPS episodes into HIPPS","text":"mergeHipps() writes single file outputDir: episodes, path written empty tibble correct column schema (see emptyHippsEpisodes()).","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/merge.html","id":"output-columns","dir":"Articles","previous_headings":"Output file: hipps_episodes.rds","what":"Output columns","title":"Merging HIP and PPS episodes into HIPPS","text":"saved data frame includes following. Columns listed “always present” every run; “present applicable” may NA omitted depending whether row came HIP, PPS, . Identifiers ordering Merged episode interval (always present) Algorithm-specific end dates (always present) Outcome categories (always present) Algorithm presence flags (always present) Optional / applicable columns may included present merged data (e.g. ESD debugging). can NA one-sided episodes. Downstream, runEsd() expects least: person_id, merge_episode_number, merge_pregnancy_start, merge_episode_start, merge_episode_end. See ESD vignette pipeline overview.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/pps.html","id":"build-pregnancy-timing-evidence","dir":"Articles","previous_headings":"","what":"Build pregnancy timing evidence","title":"PPS algorithm","text":"multiple OMOP tables, PPS extracts pregnancy-related concepts indicate gestational timing, : person_id domain_concept_start_date domain_concept_id known gestational timing range: every pregnancy record identified PPS know observation usually happens around months X–Y pregnancy. can investigate PPS concept data .","code":"min_month   max_month --------------------- 3           4      ← e.g., second trimester 8           9      ← e.g., late pregnancy 0           1      ← early pregnancy indicator"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/pps.html","id":"process-one-person-at-a-time","dir":"Articles","previous_headings":"","what":"Process one person at a time","title":"PPS algorithm","text":"person: Sort pregnancy-related records date Walk forward time Decide whether record continues current pregnancy starts new one Core idea: agreement. Two records said agree observed time difference matches pregnancy biology expect.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/pps.html","id":"how-agreement-is-computed","dir":"Articles","previous_headings":"Process one person at a time","what":"How agreement is computed","title":"PPS algorithm","text":"Suppose two records: observed spacing two records expected spacing two reacords based clinical knowledge range. slack (±2 months) calculate acceptable window observed spacing. Since observed spacing 4 months say records agreement plausibly part pregnancy episode. observed gap falls inside window → records agree. Agreement means: “two records plausibly belong pregnancy.” agreement means: “two records biologically belong pregnancy.”","code":"Jan → May ≈ 4 months min_expected = 5 − 2 = 3 months max_expected = 6 − 1 = 5 months acceptable window = 1 to 7 months"},{"path":[]},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/pps.html","id":"direct-agreement-primary-rule","dir":"Articles","previous_headings":"Agreement is evaluated in two ways","what":"Direct agreement (primary rule)","title":"PPS algorithm","text":"processing record : record agree earlier record current timeline? yes → stay episode. one match needed.","code":"Pregnancy episode |--------------------------------|  R1 ----- R2 ----- R3 ----- Ri              ↑           agrees?"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/pps.html","id":"surrounding-agreement-outlier-protection","dir":"Articles","previous_headings":"Agreement is evaluated in two ways","what":"Surrounding agreement (outlier protection)","title":"PPS algorithm","text":"Sometimes one record wrong: incorrect date miscoded concept late data entry PPS asks: Even record doesn’t agree earlier records, records around agree ? left right records agree, record treated noise kept pregnancy. prevents single bad record splitting episode.","code":"R1 ----- R2 ---- Ri ---- R4 ----- R5        |-----------------------|                 agree"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/pps.html","id":"when-does-a-new-episode-start","dir":"Articles","previous_headings":"","what":"When does a new episode start?","title":"PPS algorithm","text":"new pregnancy episode begins timing biology indicate . new episode starts :","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/pps.html","id":"rule-1-incompatible-meaningful-gap","dir":"Articles","previous_headings":"When does a new episode start?","what":"Rule 1 — incompatible + meaningful gap","title":"PPS algorithm","text":"? small gaps (<1 month) often represent: documentation retries duplicate visits late coding PPS waits real temporal break","code":"no agreement AND gap > 1 month"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/pps.html","id":"rule-2-definitely-new-pregnancy","dir":"Articles","previous_headings":"When does a new episode start?","what":"Rule 2 — definitely new pregnancy","title":"PPS algorithm","text":"Regardless agreement. ? pregnancy last long Even coding noise, must new pregnancy","code":"gap > 10 months"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/pps.html","id":"decision-diagram","dir":"Articles","previous_headings":"When does a new episode start? > Rule 2 — definitely new pregnancy","what":"Decision diagram","title":"PPS algorithm","text":"","code":"New record                       |               ┌───────┴────────┐               |                |          gap > 10 mo?      no               |                |             YES          agreement?               |                |          NEW EPISODE     yes → same                                |                           no + gap > 1 mo?                                |                             yes → new                             no  → same"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/pps.html","id":"final-cleanup-remove-implausible-pregnancies","dir":"Articles","previous_headings":"","what":"Final cleanup: remove implausible pregnancies","title":"PPS algorithm","text":"episodes assigned: episode’s duration computed episode lasting > 12 months discarded ? Normal pregnancy ≈ 9–10 months documentation noise 12 months biologically implausible episodes marked invalid (episode = 0).","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/pps.html","id":"final-output","dir":"Articles","previous_headings":"","what":"Final output","title":"PPS algorithm","text":"person: episode represents reconstructed pregnancy.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/articles/pps.html","id":"outputs-written-by-runpps","dir":"Articles","previous_headings":"","what":"Outputs written by runPps()","title":"PPS algorithm","text":"runPps() writes following files outputDir: pps_episodes.rds — Always written. PPS episodes inferred outcomes (used mergeHipps() PPS input). pps_gest_timing_episodes.rds — debugMode = TRUE. Record-level dataset pregnancy-related concept rows assigned person_episode_number. pps_min_max_episodes.rds — debugMode = TRUE. Episode-level summaries (pps_episode_min_date, pps_episode_max_date, pps_episode_max_date_plus_two_months, n_gt_concepts). full pipeline (HIP → PPS → merge → ESD), use runPregnancyIdentifier(); see pipeline overview Merge vignette. summary, PPS algorithm reconstructs pregnancy episodes checking whether spacing pregnancy-related clinical records matches biology allows, tolerating noise enforcing physiological limits.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Aniek Markus. Author. Julieta Politi. Author. Maarten van Kessel. Author, maintainer. Adam Black. Author.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Markus , Politi J, van Kessel M, Black (2026). PregnancyIdentifier: Identifies Pregnancy Episodes OMOP (Observational Medical Outcomes Partnership) CDM (Common Data Model). R package version 3.0.0, https://darwin-eu.github.io/PregnancyIdentifier/.","code":"@Manual{,   title = {PregnancyIdentifier: Identifies Pregnancy Episodes in the OMOP (Observational Medical Outcomes Partnership) CDM (Common Data Model)},   author = {Aniek Markus and Julieta Politi and Maarten {van Kessel} and Adam Black},   year = {2026},   note = {R package version 3.0.0},   url = {https://darwin-eu.github.io/PregnancyIdentifier/}, }"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/index.html","id":"pregnancyidentifier","dir":"","previous_headings":"","what":"Identifies Pregnancy Episodes in the OMOP (Observational Medical Outcomes Partnership) CDM (Common Data Model)","title":"Identifies Pregnancy Episodes in the OMOP (Observational Medical Outcomes Partnership) CDM (Common Data Model)","text":"Identify pregnancy episodes OMOP CDM data using HIPPS algorithm (Smith et al. 2024, doi:10.1093/jamia/ocae195). Observational health data rarely pregnancy_start pregnancy_end variables. often get scattered pregnancy-related events live birth, gestational week 12, delivery procedure, miscarriage, etc. PregnancyIdentifier turns pregnancy-related codes : One row per pregnancy episode Inferred start end dates (precision) gestational timing evidence. Standard outcome categories (LB, SB, AB, SA, ECT, DELIV, PREG) can use analyses exports. pipeline combines outcome-anchored episodes (HIP), timing-anchored episodes (PPS), merges (HIPPS), refines start dates (ESD)—get consistent definition pregnancy across sites data sources.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/index.html","id":"how-to-use-it","dir":"","previous_headings":"","what":"How to use it","title":"Identifies Pregnancy Episodes in the OMOP (Observational Medical Outcomes Partnership) CDM (Common Data Model)","text":"Install (requires R ≥ 4.1 CDMConnector): Run full pipeline (initializes concepts, runs HIP → PPS → merge → ESD, writes outputs): Use result:pregnancy_output/final_pregnancy_episodes.rds data frame one row per pregnancy episode: person_id, final_episode_start_date, final_episode_end_date, final_outcome_category, esd_precision_days, esd_* QA/concordance columns. Load cohort definition, export, analysis. Optional: run export de-identified summary CSVs ZIP:","code":"# From GitHub (DARWIN EU) remotes::install_github(\"darwin-eu/PregnancyIdentifier\") library(PregnancyIdentifier) library(CDMConnector)  cdm <- mockPregnancyCdm()  # or your real cdm_reference  runPregnancyIdentifier(   cdm       = cdm,   outputDir = \"pregnancy_output\",   startDate = as.Date(\"2000-01-01\"),   endDate   = Sys.Date() ) exportPregnancies(cdm, outputDir = \"pregnancy_output\", exportDir = \"pregnancy_export\")"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/index.html","id":"documentation","dir":"","previous_headings":"","what":"Documentation","title":"Identifies Pregnancy Episodes in the OMOP (Observational Medical Outcomes Partnership) CDM (Common Data Model)","text":"Vignettes: Pipeline overview, HIP, PPS, Merge, ESD. Reference: pkgdown site. Issues: GitHub issues.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/index.html","id":"license","dir":"","previous_headings":"","what":"License","title":"Identifies Pregnancy Episodes in the OMOP (Observational Medical Outcomes Partnership) CDM (Common Data Model)","text":"Apache 2.0.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/PregnancyIdentifier-package.html","id":null,"dir":"Reference","previous_headings":"","what":"PregnancyIdentifier: Identifies Pregnancy Episodes in the OMOP (Observational Medical Outcomes Partnership) CDM (Common Data Model) — PregnancyIdentifier-package","title":"PregnancyIdentifier: Identifies Pregnancy Episodes in the OMOP (Observational Medical Outcomes Partnership) CDM (Common Data Model) — PregnancyIdentifier-package","text":"Identify pregnancy episodes OMOP CDM, based HIPPS algorithm described Smith et al. (2024) doi:10.1093/jamia/ocae195 .","code":""},{"path":[]},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/PregnancyIdentifier-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"PregnancyIdentifier: Identifies Pregnancy Episodes in the OMOP (Observational Medical Outcomes Partnership) CDM (Common Data Model) — PregnancyIdentifier-package","text":"Maintainer: Maarten van Kessel m.l.vankessel@erasmusmc.com (ORCID) Authors: Aniek Markus (ORCID) Julieta Politi (ORCID) Adam Black black@ohdsi.org (ORCID)","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/cdmCommentContents.html","id":null,"dir":"Reference","previous_headings":"","what":"Insert flattened CDM records as an aligned R comment in the active editor — cdmCommentContents","title":"Insert flattened CDM records as an aligned R comment in the active editor — cdmCommentContents","text":"Flattens CDM using [CDMConnector::cdmFlatten()], collects data R, optionally filters one `person_id` values, inserts aligned, copy-pasteable comment block directly current cursor line active RStudio document.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/cdmCommentContents.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Insert flattened CDM records as an aligned R comment in the active editor — cdmCommentContents","text":"","code":"cdmCommentContents(cdm, personIds = NULL)"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/cdmCommentContents.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Insert flattened CDM records as an aligned R comment in the active editor — cdmCommentContents","text":"cdm CDM reference object created CDMConnector. personIds Optional numeric vector `person_id` values filter . `NULL`, persons flattened CDM used (use care).","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/cdmCommentContents.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Insert flattened CDM records as an aligned R comment in the active editor — cdmCommentContents","text":"Invisibly returns collected flattened CDM data.frame.   primary side effect insertion commented text active   RStudio source editor.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/cdmCommentContents.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Insert flattened CDM records as an aligned R comment in the active editor — cdmCommentContents","text":"intended lightweight debugging documentation helper inspecting patient-level timelines (e.g. cohort inclusion, outcome validation, study review notes). inserted output formatted aligned R comments: function requires interactive RStudio session error `rstudioapi` available.","code":"# person_id | observation_concept_id | start_date | end_date   | domain # 12        | 2211751                 | 2021-01-13 | 2021-01-13 | procedure_occurrence"},{"path":[]},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/cdmCommentContents.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Insert flattened CDM records as an aligned R comment in the active editor — cdmCommentContents","text":"","code":"if (FALSE) { # \\dontrun{ # Insert patient timeline directly into your script cdmCommentContents(cdm, 12)  # Insert multiple patients cdmCommentContents(cdm, c(12, 22)) } # }"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/comparePregnancyIdentifierWithPET.html","id":null,"dir":"Reference","previous_headings":"","what":"Compare runPregnancyIdentifier results with the OMOP Pregnancy Extension Table (PET) — comparePregnancyIdentifierWithPET","title":"Compare runPregnancyIdentifier results with the OMOP Pregnancy Extension Table (PET) — comparePregnancyIdentifierWithPET","text":"Compares algorithm output (final_pregnancy_episodes.rds) PET table writes comparison summaries outputFolder. Comparisons include: pregnancy episode person counts; pregnancy start/end date differences linked episodes; Venn counts (, PET , algorithm ); 2x2 confusion matrix (TP, FN, FP, TN) sensitivity, specificity, PPV, NPV; outcome confusion matrix accuracy; pregnancy duration distributions.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/comparePregnancyIdentifierWithPET.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Compare runPregnancyIdentifier results with the OMOP Pregnancy Extension Table (PET) — comparePregnancyIdentifierWithPET","text":"","code":"comparePregnancyIdentifierWithPET(   cdm,   outputDir,   outputFolder,   petSchema,   petTable,   minOverlapDays = 1L,   logger = NULL,   outputLogToConsole = TRUE )"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/comparePregnancyIdentifierWithPET.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Compare runPregnancyIdentifier results with the OMOP Pregnancy Extension Table (PET) — comparePregnancyIdentifierWithPET","text":"cdm cdm_reference (CDMConnector) database connection. PET table read via petSchema petTable. outputDir character(1). Directory containing pipeline outputs, particular final_pregnancy_episodes.rds. outputFolder character(1). Directory comparison CSVs optional plots written. Created exist. petSchema character(1). Schema name PET table (e.g. \"omop_cmbd\"). petTable character(1). Table name pregnancy episode table (e.g. \"pregnancy_episode\"). Must contain least person_id, pregnancy_start_date, pregnancy_end_date, pregnancy_outcome (concept_id). minOverlapDays integer(1). Minimum overlap days consider algorithm episode PET episode pregnancy (default 1). logger Optional log4r::logger. NULL, logger created via makeLogger(outputFolder). outputLogToConsole logical(1). Used logger NULL. Whether log console well log file.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/comparePregnancyIdentifierWithPET.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Compare runPregnancyIdentifier results with the OMOP Pregnancy Extension Table (PET) — comparePregnancyIdentifierWithPET","text":"Invisibly returns list elements episode_counts,   venn_counts, confusion_2x2, ppv_sensitivity,   date_differences, outcome_confusion, outcome_accuracy,   duration_summary, duration_distribution. confusion_2x2   2x2 table (TP, FN, FP, TN; TN NA episode level).   ppv_sensitivity contains sensitivity, specificity, PPV, NPV   (specificity NPV NA TN defined). comparison   artifacts also written outputFolder CSVs (optionally PNGs).","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/exportPregnancies.html","id":null,"dir":"Reference","previous_headings":"","what":"Export pregnancy results into shareable summary CSVs — exportPregnancies","title":"Export pregnancy results into shareable summary CSVs — exportPregnancies","text":"Reads patient-level pregnancy episode results produced pipeline (`outputDir`; see `runPregnancyIdentifier()`), generates set de-identified summary tables (counts, age summaries, timing distributions, outcome counts, date completeness checks), writes `exportDir`, creates ZIP archive exported files.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/exportPregnancies.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Export pregnancy results into shareable summary CSVs — exportPregnancies","text":"","code":"exportPregnancies(cdm, outputDir, exportDir, minCellCount = 5)"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/exportPregnancies.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Export pregnancy results into shareable summary CSVs — exportPregnancies","text":"cdm (`cdm_reference`) CDM reference used compute exports require database tables (e.g., `person`, `observation_period`). outputDir (`character(1)`) Directory containing pipeline outputs (e.g., `final_pregnancy_episodes.rds`, logs, `pps_concept_counts.csv`). exportDir (`character(1)`) Directory shareable CSVs (ZIP) written. minCellCount (`integer(1)`) Minimum count threshold suppression small cells (default 5). Values (0, minCellCount) replaced `NA`.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/exportPregnancies.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Export pregnancy results into shareable summary CSVs — exportPregnancies","text":"Invisibly returns `NULL`. Writes CSVs ZIP file `exportDir`.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/exportPregnancies.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Export pregnancy results into shareable summary CSVs — exportPregnancies","text":"export intended lightweight QA sharing across sites. Small cell counts can suppressed via `minCellCount`.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/initPregnancies.html","id":null,"dir":"Reference","previous_headings":"","what":"Create Initial Pregnancy Table — initPregnancies","title":"Create Initial Pregnancy Table — initPregnancies","text":"Get initial cohort based HIP concepts women age 15 55 time pregnancy","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/initPregnancies.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Create Initial Pregnancy Table — initPregnancies","text":"","code":"initPregnancies(   cdm,   startDate = as.Date(\"1900-01-01\"),   endDate = Sys.Date(),   ageBounds = c(15L, 56L),   logger,   outputDir = NULL )"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/initPregnancies.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Create Initial Pregnancy Table — initPregnancies","text":"cdm CDM reference startDate Earliest date look pregnancies CDM endDate Latest date look pregnancies CDM ageBounds upper lower bounds age pregnancy end date represented using length 2 integer vector. default c(15, 56) include anyone >= 15 < 56. logger log4r logger object can created `makeLogger()` outputDir Optional directory path. provided, attrition.csv file created initial record person counts preg_hip_records preg_pps_records.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/initPregnancies.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Create Initial Pregnancy Table — initPregnancies","text":"input CDM new tables added called preg_hip_records, preg_pps_records, preg_hip_concepts, preg_pps_concepts.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/initPregnancies.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Create Initial Pregnancy Table — initPregnancies","text":"","code":"if (FALSE) { # \\dontrun{ logger <- makeLogger(tempdir()) cdm <- mockPregnancyCdm() cdm <- initPregnancies(cdm, logger = logger) } # }"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/makeLogger.html","id":null,"dir":"Reference","previous_headings":"","what":"Create a new logger — makeLogger","title":"Create a new logger — makeLogger","text":"Create new logger","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/makeLogger.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Create a new logger — makeLogger","text":"","code":"makeLogger(outputDir, outputLogToConsole = TRUE)"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/makeLogger.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Create a new logger — makeLogger","text":"outputDir directory log created outputLogToConsole (`logical(1)`) `TRUE` (default), log messages written console well log file. `FALSE`, file appender used (useful tests keep output clean).","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/makeLogger.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Create a new logger — makeLogger","text":"log4r logger object","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/mergeHipps.html","id":null,"dir":"Reference","previous_headings":"","what":"Merge HIP and PPS episodes into a unified HIPPS episode table — mergeHipps","title":"Merge HIP and PPS episodes into a unified HIPPS episode table — mergeHipps","text":"Reads previously-saved HIP PPS outputs `outputDir`, merges HIP PPS episodes based temporal overlap, resolves many--many overlaps selecting best-matching pairs, returns single per-person episode table standardized columns used downstream ESD reporting.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/mergeHipps.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Merge HIP and PPS episodes into a unified HIPPS episode table — mergeHipps","text":"","code":"mergeHipps(outputDir, logger)"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/mergeHipps.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Merge HIP and PPS episodes into a unified HIPPS episode table — mergeHipps","text":"outputDir (`character(1)`) Directory containing intermediate RDS artifacts: `pps_episodes.rds`, `hip_episodes.rds` logger (`logger`) log4r logger created `makeLogger()`.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/mergeHipps.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Merge HIP and PPS episodes into a unified HIPPS episode table — mergeHipps","text":"Invisibly returns `NULL` writes `hipps_episodes.rds` `outputDir`.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/mergeHipps.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Merge HIP and PPS episodes into a unified HIPPS episode table — mergeHipps","text":"Key steps: Load HIP episodes PPS episodes `outputDir` Merge HIP + PPS episodes overlap; flag episodes involved many--many overlaps Resolve many--many overlaps selecting best-matching pairs (retain best matches end-date proximity episode plausibility) Add standardized columns per-person episode ordering; write `hipps_episodes.rds`","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/mockPregnancyCdm.html","id":null,"dir":"Reference","previous_headings":"","what":"Create a mock pregnancy cdm for examples and testing — mockPregnancyCdm","title":"Create a mock pregnancy cdm for examples and testing — mockPregnancyCdm","text":"Create mock pregnancy cdm examples testing","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/mockPregnancyCdm.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Create a mock pregnancy cdm for examples and testing — mockPregnancyCdm","text":"","code":"mockPregnancyCdm(fullVocab = TRUE)"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/mockPregnancyCdm.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Create a mock pregnancy cdm for examples and testing — mockPregnancyCdm","text":"fullVocab `TRUE` (default), CDM includes full vocabulary tables. `FALSE`, concept, concept_relationship, concept_ancestor, concept_synonym subset concept IDs appear data ([CDMConnector::cdmFlatten()] observation_concept_id), lighter testing different database systems.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/mockPregnancyCdm.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Create a mock pregnancy cdm for examples and testing — mockPregnancyCdm","text":"cdm reference example pregnancy data ","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/mockPregnancyCdm.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Create a mock pregnancy cdm for examples and testing — mockPregnancyCdm","text":"","code":"if (FALSE) { # \\dontrun{ cdm <- mockPregnancyCdm() cdm_small_vocab <- mockPregnancyCdm(fullVocab = FALSE) } # }"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/runEsd.html","id":null,"dir":"Reference","previous_headings":"","what":"runEsd — runEsd","title":"runEsd — runEsd","text":"Runs Episode Start Date (ESD) algorithm infer pregnancy episode start dates merged HIP/PPS episodes.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/runEsd.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"runEsd — runEsd","text":"","code":"runEsd(   cdm,   outputDir,   startDate = as.Date(\"1900-01-01\"),   endDate = Sys.Date(),   logger,   debugMode = FALSE,   conformToValidation = FALSE )"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/runEsd.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"runEsd — runEsd","text":"cdm CDM reference, must include necessary OMOP tables concept sets pregnancy inference algorithms. outputDir Character. Path directory input output RDS files reside. startDate Earliest episode date include (.Date). Default: .Date(\"1900-01-01\"). endDate Latest episode date include (.Date). Default: Sys.Date(). logger log4r logger object info/debug messages. debugMode (`logical(1)`) ESD algorithm write intermediate datasets outputDir? `TRUE` `FALSE` (default) conformToValidation (`logical(1)`: `FALSE`) `TRUE`, modify episodes conform (remove overlaps length > 308 days). Validation logging always run.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/runEsd.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"runEsd — runEsd","text":"Invisibly returns NULL. Main result written RDS file (final_pregnancy_episodes.rds) outputDir.         output contains one row per inferred pregnancy episode. Columns include: final_episode_start_date, final_episode_end_date, final_outcome_category (prefix), ESD-derived columns esd_ prefix: esd_precision_days, esd_precision_category, esd_gestational_age_days_calculated, esd_gw_flag, esd_gr3m_flag, esd_outcome_match, esd_term_duration_flag, esd_outcome_concordance_score, esd_preterm_status_from_calculation, plus merge/HIPPS metadata (e.g. recorded_episode_start, hip_end_date, pps_end_date).","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/runEsd.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"runEsd — runEsd","text":"function performs following major steps: Loads previously merged HIPPS episode table outputDir. Extracts gestational timing concept evidence (e.g. gestational week, trimester concepts) episode within specified date range. Infers episode start start precision using available gestational timing evidence, logging. Merges inferred start dates, timing evidence, metadata back onto merged episodes table computes final start/end/outcome fields. Filters episodes retain overlapping requested startDate–endDate study period, including episodes missing inferred dates. Writes resulting cohort identified pregnancy episodes RDS file (final_pregnancy_episodes.rds) outputDir.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/runHip.html","id":null,"dir":"Reference","previous_headings":"","what":"Run the HIP pregnancy identification algorithm — runHip","title":"Run the HIP pregnancy identification algorithm — runHip","text":"function runs HIP outcome based pregnancy identification algorithm. assumes `initPregnancies` function already run preg_hip_records preg_hip_concepts tables cdm. algorithm identifies start end dates pregnancies first prioritizing pregnancy outcomes using inference set pregnancy start date. pregnancy classified one several categories. - \"LB\": Live birth - \"SB\": Still birth - \"AB\": abortion, - \"SA\": miscarriage, - \"DELIV\": unspecified delivery - \"ECT\": ectopic pregnancy - \"PREG\": unspecified/ongoing pregnancy","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/runHip.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Run the HIP pregnancy identification algorithm — runHip","text":"","code":"runHip(   cdm,   outputDir = NULL,   startDate = as.Date(\"1900-01-01\"),   endDate = Sys.Date(),   justGestation = TRUE,   logger )"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/runHip.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Run the HIP pregnancy identification algorithm — runHip","text":"cdm (`cdm_reference`) cdm reference object CDMConnector. outputDir (`character(1)`) Output directory write output . startDate (`Date(1)`: `.Date(\"1900-01-01\"`) Start date data use. default 1900-01-01 endDate (`Date(1)`: `Sys.Date()`) End date data use. default today. justGestation (`logical(1)`: `TRUE`) episodes gestational concepts considered? logger (`logger`) log4r logger object created `makeLogger()`.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/runHip.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Run the HIP pregnancy identification algorithm — runHip","text":"input cdm object `cdm$preg_hip_episodes` table added. table contains episode-level information identified pregnancy per individual. columns : - `person_id`: Unique identifier person. - `hip_episode`: Sequential episode number person (1 = first episode, etc.). - `hip_pregnancy_start`: Estimated start date pregnancy episode, based outcome available gestational age information. - `hip_pregnancy_end`: Date principal pregnancy outcome event (pregnancy end date). - `hip_outcome_category`: HIP-assigned pregnancy outcome type. One \"LB\" (live birth), \"SB\" (stillbirth), \"AB\" (abortion), \"SA\" (miscarriage), \"DELIV\" (unspecified delivery), \"ECT\" (ectopic pregnancy), \"PREG\" (ongoing/unspecified). - `hip_first_gest_date`: First gestation date episode (available). NA identified. - `hip_gest_flag`: Indicates gestational age concepts found episode (\"yes\" \"\"). - `hip_episode_length`: Length pregnancy episode, days (`hip_pregnancy_start` `hip_pregnancy_end`). file named `hip_episodes.rds` saved `outputDir` directory. file contains dataframe columns listed `cdm$preg_hip_episodes` table.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/runPps.html","id":null,"dir":"Reference","previous_headings":"","what":"Run the PPS Algorithm to Identify Pregnancy Episodes — runPps","title":"Run the PPS Algorithm to Identify Pregnancy Episodes — runPps","text":"function executes Pregnancy Progression Signature (PPS) algorithm Common Data Model (CDM) instance. inserts required PPS concept lookup table, extracts gestational timing evidence (e.g., gestational weeks, trimesters) across OMOP clinical domains, assembles person-level gestational timing records, writes intermediate episode summary files specified output directory.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/runPps.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Run the PPS Algorithm to Identify Pregnancy Episodes — runPps","text":"","code":"runPps(   cdm,   outputDir,   startDate = as.Date(\"1900-01-01\"),   endDate = Sys.Date(),   logger,   debugMode = FALSE )"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/runPps.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Run the PPS Algorithm to Identify Pregnancy Episodes — runPps","text":"cdm `cdm_reference` object; must include OMOP tables structure needed pregnancy concept search. outputDir Character. Directory path intermediate output RDS files saved. startDate Date (`Date(1)`). Earliest clinical date considered gestational timing evidence (default: `\"1900-01-01\"`). endDate Date (`Date(1)`). Latest clinical date considered gestational timing evidence (default: `Sys.Date()`). logger `log4r` logger object (required) emitting information debug messages. debugMode (`Logical`) intermediate datasets written output folder debugging? TRUE FALSE (default)","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/runPps.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Run the PPS Algorithm to Identify Pregnancy Episodes — runPps","text":"Returns input `cdm_reference` invisibly, possibly modified intermediate tables environment.         Main results side effects: RDS files person-level gestational timing episodes summary statistics written `outputDir`.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/runPregnancyIdentifier.html","id":null,"dir":"Reference","previous_headings":"","what":"Run PregnancyIdentifier end-to-end (HIP + PPS + merge + ESD, optionally export) — runPregnancyIdentifier","title":"Run PregnancyIdentifier end-to-end (HIP + PPS + merge + ESD, optionally export) — runPregnancyIdentifier","text":"Orchestrates full PregnancyIdentifier pipeline (adapted HIPPS implementation https://github.com/louisahsmith/allofus-pregnancy/) OMOP CDM `CDMConnector`.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/runPregnancyIdentifier.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Run PregnancyIdentifier end-to-end (HIP + PPS + merge + ESD, optionally export) — runPregnancyIdentifier","text":"","code":"runPregnancyIdentifier(   cdm,   outputDir,   startDate = as.Date(\"1900-01-01\"),   endDate = Sys.Date(),   justGestation = TRUE,   minCellCount = 5L,   debugMode = FALSE,   runExport = FALSE,   outputLogToConsole = TRUE,   conformToValidation = FALSE )"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/runPregnancyIdentifier.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Run PregnancyIdentifier end-to-end (HIP + PPS + merge + ESD, optionally export) — runPregnancyIdentifier","text":"cdm (`cdm_reference`) CDM reference created `CDMConnector` pointing OMOP CDM instance. outputDir (`character(1)`) Directory intermediate artifacts (RDS, logs) exports written. Created exist. startDate (`Date(1)`) Lower bound concept/event dates included run. Default `1900-01-01`. endDate (`Date(1)`) Upper bound concept/event dates included run. Default `Sys.Date()`. justGestation (`logical(1)`) `TRUE`, allow episodes consisting gestational concepts (HIP behavior). Passed `runHip()`. minCellCount (`integer(1)`) Minimum cell count used suppression exported summaries. Passed `exportPregnancies()` `runExport = TRUE`. debugMode (`logical(1)`) extra intermediate datasets written outputDir debugging? `TRUE` `FALSE` (default) runExport (`logical(1)`) `TRUE`, run `exportPregnancies()` ESD write shareable CSVs ZIP `file.path(outputDir, \"export\")`. Default `FALSE`. outputLogToConsole (`logical(1)`) `TRUE` (default), log messages written console. `FALSE`, log file (e.g. tests). conformToValidation (`logical(1)`) `TRUE`, validation modify episode output conform: remove overlapping episodes episodes longer 308 days. `FALSE` (default), validate log issues; modify result. Validation logging always run regardless parameter.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/runPregnancyIdentifier.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Run PregnancyIdentifier end-to-end (HIP + PPS + merge + ESD, optionally export) — runPregnancyIdentifier","text":"Invisibly returns `NULL`. Side effects:   - Adds/updates tables inside `cdm` (e.g., `cdm$preg_hip_records`, concept     tables, intermediate algorithm tables).   - Writes intermediate RDS artifacts `outputDir`.   - `runExport = TRUE`, writes shareable csv exports     `file.path(outputDir, \"export\")`.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/runPregnancyIdentifier.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Run PregnancyIdentifier end-to-end (HIP + PPS + merge + ESD, optionally export) — runPregnancyIdentifier","text":"pipeline performs: 1) cohort initialization (`initPregnancies()`): creates pregnancy-related concept    tables initial cohort CDM, 2) HIP episode identification (`runHip()`): identifies episodes based HIP rules, 3) PPS episode identification (`runPps()`): identifies episodes based PPS rules, 4) merge (`mergeHipps()`): merges HIP PPS combined HIPPS episodes, 5) ESD refinement (`runEsd()`): derives inferred pregnancy start/precision    enriches merged episodes, 6) optionally, export (`exportPregnancies()`): writes shareable summary outputs    (optional small-cell suppression) `exportPregnancies = TRUE`.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/validateEpisodePeriods.html","id":null,"dir":"Reference","previous_headings":"","what":"Validate episode periods: overlaps within person and max duration — validateEpisodePeriods","title":"Validate episode periods: overlaps within person and max duration — validateEpisodePeriods","text":"Checks dataframe episode periods (start/end dates per person) two conditions logs warnings: (1) number records overlap another record within person; (2) number records whose span (end - start days) exceeds maximum (default 308 days).","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/validateEpisodePeriods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Validate episode periods: overlaps within person and max duration — validateEpisodePeriods","text":"","code":"validateEpisodePeriods(   df,   personIdCol,   startDateCol,   endDateCol,   logger,   maxDays = 308 )"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/validateEpisodePeriods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Validate episode periods: overlaps within person and max duration — validateEpisodePeriods","text":"df dataframe least person id start/end date columns. personIdCol Character. Name person identifier column. startDateCol Character. Name period start date column. endDateCol Character. Name period end date column. logger log4r logger object (e.g. `makeLogger()`). maxDays Numeric. Threshold days second warning (default 308).","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/validateEpisodePeriods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Validate episode periods: overlaps within person and max duration — validateEpisodePeriods","text":"Invisibly returns `df` unchanged.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/viewResults.html","id":null,"dir":"Reference","previous_headings":"","what":"View the results in the Shiny app — viewResults","title":"View the results in the Shiny app — viewResults","text":"View results Shiny app","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/viewResults.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"View the results in the Shiny app — viewResults","text":"","code":"viewResults(   dataFolder,   makePublishable = FALSE,   publishDir = file.path(getwd(), \"PregnancyViewer\"),   overwritePublishDir = FALSE,   launch.browser = FALSE )"},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/viewResults.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"View the results in the Shiny app — viewResults","text":"dataFolder folder exported zip files results stored. Zip files containing results multiple databases can placed folder. makePublishable (Optional) copy data files make app publishable posit connect/shinyapp.io publishDir make publishable true - directory shiny app copied overwritePublishDir (Optional) make publishable true - overwrite directory publishing launch.browser app launched default browser, Shiny window. Note: copying clipboard work Shiny window.","code":""},{"path":"https://darwin-eu-dev.github.io/PregnancyIdentifier/reference/viewResults.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"View the results in the Shiny app — viewResults","text":"Launches Shiny app allows user explore diagnostics","code":""}]
