<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>HIP algorithm • PregnancyIdentifier</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="HIP algorithm">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PregnancyIdentifier</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>HIP algorithm</h1>
            
      

      <div class="d-none name"><code>hip.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The <strong>HIP</strong> (outcome-anchored) algorithm identifies
pregnancy episodes by combining <strong>high-specificity pregnancy
outcomes</strong> (e.g., live birth, stillbirth, abortion) with
<strong>gestational-age evidence</strong> (weeks of gestation) when
available. It produces one record per inferred pregnancy, including an
<strong>episode end date</strong> (<code>hip_pregnancy_end</code>), an
<strong>estimated start date</strong>
(<code>hip_pregnancy_start</code>), and a <strong>pregnancy
category</strong>.</p>
<p>HIP is run via <code><a href="../reference/runHip.html">runHip()</a></code>, which assumes
<code><a href="../reference/initPregnancies.html">initPregnancies()</a></code> has already been run and that the CDM
contains <code>preg_hip_records</code> and
<code>preg_hip_concepts</code>. HIP writes <code>hip_episodes.rds</code>
to <code>outputDir</code> and adds the internal table
<code>cdm$preg_hip_episodes</code> during execution.</p>
</div>
<div class="section level2">
<h2 id="two-pass-structure">Two-pass structure<a class="anchor" aria-label="anchor" href="#two-pass-structure"></a>
</h2>
<p>HIP runs in two conceptual passes:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Outcome-first pass (high specificity):</strong> Treat
recorded pregnancy outcomes as the anchor (the pregnancy “end”), and
infer plausible start dates using outcome-specific gestational duration
ranges (Matcho term durations).</li>
<li>
<strong>Gestation pass (higher sensitivity):</strong> Group
gestational-age records into pregnancy episodes for pregnancies that may
not have a recorded outcome, then merge these episodes with
outcome-based episodes and resolve conflicts.</li>
</ol>
<p>The result is a single episode table that can include:</p>
<ul>
<li>Pregnancies with <strong>outcome evidence</strong> (outcome anchors
the end date).</li>
<li>Pregnancies with <strong>gestation evidence only</strong>
(optionally included via <code>justGestation = TRUE</code>).</li>
<li>Pregnancies where <strong>both</strong> sources reinforce one
another.</li>
</ul>
</div>
<div class="section level2">
<h2 id="what-hip-is-trying-to-solve">What HIP is trying to solve<a class="anchor" aria-label="anchor" href="#what-hip-is-trying-to-solve"></a>
</h2>
<p>Observational data commonly contains:</p>
<ul>
<li>Multiple outcome records for the <em>same</em> pregnancy (duplicate
coding, follow-up visits).</li>
<li>Outcome records close together that may represent the <em>same</em>
episode or <em>distinct</em> pregnancies depending on spacing.</li>
<li>Pregnancies with <strong>no explicit outcome</strong> but with
gestational age documentation (ultrasound, prenatal visits).</li>
<li>Conflicts between outcome timing and gestational timing (e.g.,
gestational evidence implies an implausible duration).</li>
</ul>
<p>HIP addresses this by:</p>
<ul>
<li>Enforcing <strong>minimum spacing rules</strong> between outcomes
(Matcho outcome limits) so pregnancies are not over-counted.</li>
<li>Inferring start dates using <strong>outcome-specific term
ranges</strong> (min/max gestational days per category).</li>
<li>Using <strong>gestational-age trajectories</strong> to detect
pregnancies that outcomes miss and to attach gestation-only episodes
when <code>justGestation</code> is TRUE.</li>
</ul>
</div>
<div class="section level2">
<h2 id="main-stages-internal-logic">Main stages (internal logic)<a class="anchor" aria-label="anchor" href="#main-stages-internal-logic"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p><strong>Matcho outcome limits</strong> — A table of minimum
spacing (days) between consecutive outcome categories is inserted into
the CDM and used to decide when two outcome visits belong to the same
vs. different pregnancies.</p></li>
<li><p><strong>Build final outcome visits</strong> — For each outcome
category group (AB/SA, DELIV, ECT, SB, LB), HIP builds candidate outcome
visits from <code>preg_hip_records</code>, applies spacing rules, and
produces a list of final visit tables (e.g. <code>finalLbVisits</code>,
<code>finalSbVisits</code>).</p></li>
<li><p><strong>Build outcome episodes</strong> — These final visit
tables are combined into a single outcome-episode table
(<code>outcome_episodes_df</code>) with <code>person_id</code>,
<code>outcome_category</code>, <code>outcome_date</code>, and
<code>outcome_id</code>. Outcome categories are ordered (e.g. LB, SB,
ECT, AB/SA, DELIV) and spacing between categories is enforced using
Matcho limits.</p></li>
<li><p><strong>Estimate outcome starts</strong> — Each outcome episode
is joined to Matcho term durations to get <code>min_term</code> and
<code>max_term</code> (gestational days). From these, HIP derives
<code>min_start_date</code> and <code>max_start_date</code> for the
inferred pregnancy interval.</p></li>
<li><p><strong>Build gestation episodes</strong> — From
<code>preg_hip_records</code>, HIP builds gestation-based episodes
(grouped by person and visit/gestational evidence), computes max/min
gest dates and gest weeks, and stores them in
<code>gest_episodes_df</code>.</p></li>
<li><p><strong>Merge outcome and gestation</strong> — Outcome episodes
(with start bounds) and gestation episodes are joined by person and
overlapping intervals. For each person, episodes are classified as: (a)
both outcome and gestation, (b) outcome only, or (c) gestation only (if
<code>justGestation</code>). These are unioned into
<code>merged_episodes_df</code>.</p></li>
<li><p><strong>Clean and resolve overlaps</strong> — Merged episodes are
cleaned (e.g. reclassify implausible term durations to PREG, set
removed_outcome), then overlapping PREG gestation episodes are resolved
so each final episode has a single <code>final_start_date</code> and no
duplicate overlap.</p></li>
<li><p><strong>Attach gestation and length</strong> — Final episodes are
joined to gestation visit-level data to attach <code>gest_flag</code>
and <code>episode_length</code>, producing
<code>preg_hip_episodes</code>. This table is collected and saved as
<code>hip_episodes.rds</code>.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="hip-outputs-and-categories">HIP outputs and categories<a class="anchor" aria-label="anchor" href="#hip-outputs-and-categories"></a>
</h2>
<p>HIP episodes include:</p>
<ul>
<li>
<code>person_id</code> — Unique person identifier.</li>
<li>
<code>hip_first_gest_date</code> — First gestation date in the
episode (or NA if no gestational visit in the episode window).</li>
<li>
<code>hip_pregnancy_end</code> — Episode end date (outcome date or
max gest date).</li>
<li>
<code>hip_pregnancy_start</code> — Inferred pregnancy start
date.</li>
<li>
<code>category</code> — One of: <code>LB</code>, <code>SB</code>,
<code>AB</code>, <code>SA</code>, <code>DELIV</code>, <code>ECT</code>,
<code>PREG</code>.</li>
<li>
<code>gest_flag</code> — Whether gestational evidence supported the
episode.</li>
<li>
<code>episode_length</code> — Duration measure for the episode.</li>
<li>
<code>episode</code> — Within-person episode number.</li>
</ul>
<p>Interpretation of categories:</p>
<ul>
<li>
<strong>LB</strong> — Live birth outcome anchors the episode
end.</li>
<li>
<strong>SB</strong> — Stillbirth.</li>
<li>
<strong>AB</strong> — Abortion.</li>
<li>
<strong>SA</strong> — Miscarriage (spontaneous abortion).</li>
<li>
<strong>DELIV</strong> — Delivery record present but not classified
as LB/SB.</li>
<li>
<strong>ECT</strong> — Ectopic pregnancy.</li>
<li>
<strong>PREG</strong> — Pregnancy inferred from gestational evidence
without a usable outcome anchor (or outcome evidence was deemed
implausible).</li>
</ul>
</div>
<div class="section level2">
<h2 id="running-hip-alone">Running HIP alone<a class="anchor" aria-label="anchor" href="#running-hip-alone"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/PregnancyIdentifier/" class="external-link">PregnancyIdentifier</a></span><span class="op">)</span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mockPregnancyCdm.html">mockPregnancyCdm</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">logger</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeLogger.html">makeLogger</a></span><span class="op">(</span><span class="st">"hip_output"</span><span class="op">)</span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initPregnancies.html">initPregnancies</a></span><span class="op">(</span><span class="va">cdm</span>, startDate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2000-01-01"</span><span class="op">)</span>, endDate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, ageBounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15L</span>, <span class="fl">56L</span><span class="op">)</span>, logger <span class="op">=</span> <span class="va">logger</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runHip.html">runHip</a></span><span class="op">(</span></span>
<span>  <span class="va">cdm</span>,</span>
<span>  outputDir  <span class="op">=</span> <span class="st">"hip_output"</span>,</span>
<span>  startDate  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2000-01-01"</span><span class="op">)</span>,</span>
<span>  endDate    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  justGestation <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  logger     <span class="op">=</span> <span class="va">logger</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># hip_episodes.rds is written to hip_output/</span></span></code></pre></div>
<p>For the full pipeline (HIP → PPS → merge → ESD), use
<code><a href="../reference/runPregnancyIdentifier.html">runPregnancyIdentifier()</a></code>; see the <a href="algorithm.html">pipeline overview</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Aniek Markus, Julieta Politi, Maarten van Kessel, Adam Black.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
