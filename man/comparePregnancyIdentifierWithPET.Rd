% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/compareWithPET.R
\name{comparePregnancyIdentifierWithPET}
\alias{comparePregnancyIdentifierWithPET}
\title{Compare runPregnancyIdentifier results with the OMOP Pregnancy Extension Table (PET)}
\usage{
comparePregnancyIdentifierWithPET(
  cdm,
  outputDir,
  outputFolder,
  petSchema,
  petTable,
  minOverlapDays = 1L,
  removeWithinSourceOverlaps = FALSE,
  logger = NULL,
  outputLogToConsole = TRUE
)
}
\arguments{
\item{cdm}{A \code{cdm_reference} (from CDMConnector) with a database connection.
The PET table is read via \code{petSchema} and \code{petTable}.}

\item{outputDir}{\code{character(1)}. Directory containing pipeline outputs, in
particular \code{final_pregnancy_episodes.rds}.}

\item{outputFolder}{\code{character(1)}. Directory where comparison CSVs and
optional plots will be written. Created if it does not exist.}

\item{petSchema}{\code{character(1)}. Schema name of the PET table (e.g.
\code{"omop_cmbd"}).}

\item{petTable}{\code{character(1)}. Table name of the pregnancy episode table
(e.g. \code{"pregnancy_episode"}). Must contain at least \code{person_id},
\code{pregnancy_start_date}, \code{pregnancy_end_date}, and
\code{pregnancy_outcome} (concept_id).}

\item{minOverlapDays}{\code{integer(1)}. Minimum overlap in days to consider an
algorithm episode and a PET episode as the same pregnancy (default 1).}

\item{removeWithinSourceOverlaps}{\code{logical(1)}. If \code{TRUE}, before
matching the code removes overlapping episodes within PET and within the
algorithm (greedy non-overlapping by start date per person), which can
reduce many-to-many candidate pairs. Default \code{FALSE}.}

\item{logger}{Optional \code{log4r::logger}. If \code{NULL}, a logger is
created via \code{makeLogger(outputFolder)}.}

\item{outputLogToConsole}{\code{logical(1)}. Used only when \code{logger} is
\code{NULL}. Whether to log to the console as well as to the log file.}
}
\value{
Invisibly returns a list with elements \code{episode_counts},
  \code{protocol_summary} (total PET, algorithm, matched counts for protocol reporting),
  \code{person_overlap}, \code{venn_counts}, \code{time_overlap_summary},
  \code{confusion_2x2}, \code{ppv_sensitivity}, \code{duration_summary},
  \code{duration_matched_summary} (duration stats for matched pairs only),
  \code{date_differences}, \code{outcome_confusion}, \code{outcome_accuracy},
  \code{outcome_by_year}, and \code{duration_distribution}. \code{person_overlap}
  has raw and cohort (filtered) person overlap counts. \code{time_overlap_summary}
  has min/Q25/median/Q75/max/sd and n_episodes/n_persons for PET->IPE and IPE->PET
  with 0 or 1 day overlap required. \code{outcome_by_year} is the same-year outcome
  cross-tab (lb_lb, sb_sb, ab_ab, etc.). \code{confusion_2x2} is the 2x2 table
  (TP, FN, FP, TN; TN is \code{NA} at episode level). All comparison artifacts
  are also written to \code{outputFolder} as CSVs (and optionally PNGs).
}
\description{
Compares algorithm output (from \code{final_pregnancy_episodes.rds}) to the PET
table and writes comparison summaries to \code{outputFolder}. Comparisons include:
pregnancy episode and person counts; raw and filtered (gestation 0-308, end >= start)
person overlap; time-overlap summaries (PET->IPE and IPE->PET, 0 and 1 day);
Venn counts (both, PET only, algorithm only); a 2x2 confusion matrix (TP, FN, FP, TN)
with sensitivity, specificity, PPV, and NPV; outcome confusion matrix and accuracy;
outcome comparison by year (same-year pairs, cross-tab LB/SB/AB vs PET outcome);
and pregnancy duration distributions.
}
